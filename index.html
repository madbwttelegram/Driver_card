<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap"
    rel="stylesheet">

  <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª jsPDF Ùˆ html2canvas -->
  <script src="./jspdf.umd.min.js"></script>
  <script src="./html2canvas.min.js"></script>
  <style>
    /* ================= PDF SCOPE (Ø¹Ø²Ù„ ÙƒØ§Ù…Ù„) ================= */
.pdf-scope {
  all: initial;
  font-family: "Tajawal", "Roboto", sans-serif;
}

/* ================= PAGE / CARD ================= */
.pdf-scope .card-preview {
  width: 555pt;
  height: 802pt;
  background: #ffffff;
  position: relative;
  overflow: hidden;
  margin: 0;
}

/* ================= BACKGROUND ================= */
.pdf-scope .card-bg-placeholder {
  position: absolute;
  inset: 0;
  background-color: #f8f8f8;
  z-index: 0;
}

.pdf-scope .bg-img,
.pdf-scope .card-bg-img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
}

/* ================= CONTENT LAYER ================= */
.pdf-scope .card-content {
  position: relative;
  z-index: 1;
  padding: 0 45pt;
}

/* ================= HEADER ================= */
.pdf-scope .card-header {
  position: absolute;
  top: 95pt;
  left: 0;
  right: 0;
  text-align: center;
  color: #8B2B3E;
  z-index: 10;
}

.pdf-scope .card-header h1 {
  margin: 0;
  font-size: 18pt;
  font-weight: 700;
  line-height: 1.2;
}

.pdf-scope .card-header p {
  margin: 4pt 0 0;
  font-size: 11pt;
  font-family: "Roboto";
  font-weight: 500;
  color: #707070;
}

/* ================= QR ================= */
.pdf-scope .card-qr {
  position: absolute;
  top: 75pt;
  left: 60pt;
  width: 75pt;
  height: 75pt;
  z-index: 10;
  background: #fff;
  padding: 4px;
  border-radius: 4px;
  border: 1px solid rgba(0,0,0,0.1);
}

/* ================= SECTIONS ================= */
.pdf-scope .card-section {
  margin-top: 170pt;
}

.pdf-scope .card-section + .card-section {
  margin-top: 30pt;
}

.pdf-scope .card-section-title {
  background: #ffffff;
  padding: 10pt 45pt;
  margin: 0 -45pt;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #8B2B3E;
  font-weight: 700;
  font-size: 14pt;
}

.pdf-scope .card-section-body {
  background: #f3f4f6;
  padding: 25pt 45pt;
  margin: 0 -45pt;
}

/* ================= GRID ================= */
.pdf-scope .card-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14pt 30pt;
}

/* ================= ROW ================= */
.pdf-scope .card-row {
  position: relative;
  min-height: 20pt;
  font-size: 11pt;
  line-height: 1.7;
}

/* ================= LABEL / VALUE ================= */
.pdf-scope .card-label {
  position: absolute;
  inset-inline-start: 0;
  color: #707070;
  font-weight: 400;
  white-space: nowrap;
}

.pdf-scope .card-value {
  position: absolute;
  inset-inline-start: 140px;
  font-weight: 500;
  color: #000;
  white-space: nowrap;
}

.pdf-scope .card-value-ar {
  direction: rtl;
  text-align: right;
}

.pdf-scope .card-value-en {
  direction: ltr;
  text-align: left;
}

.pdf-scope .card-ltr {
  direction: ltr;
  font-family: "Roboto";
}

/* ================= FOOTER ================= */
.pdf-scope .card-footer {
  position: absolute;
  bottom: 45pt;
  left: 45pt;
  right: 45pt;
  display: flex;
  justify-content: space-between;
  font-size: 8pt;
  line-height: 1.6;
  color: #333;
  z-index: 2;
}

.pdf-scope .card-footer div {
  width: 48%;
}
  </style>
  <style>
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    h2.page-title {
      text-align: center;
      color: #8B3C45;
      font-size: 24px;
      margin-bottom: 30px;
      border-bottom: 2px solid #8B3C45;
      padding-bottom: 10px;
    }

    .section-title {
      background-color: #8B3C45;
      color: white;
      padding: 10px 15px;
      font-size: 16px;
      margin-top: 30px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      color: #555;
    }

    input, select {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input:focus, select:focus {
      border-color: #8B3C45;
      outline: none;
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
    .actions {
      display: flex;
      gap: 15px;
      margin-top: 40px;
    }

    .btn {
      flex: 1;
      padding: 12px 30px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Tajawal', sans-serif;
      border: none;
      color: white;
    }

    .btn-preview { background-color: #555; }
    .btn-preview:hover { background-color: #333; }
    
    .btn-submit { background-color: #8B3C45; }
    .btn-submit:hover { background-color: #703038; }

    /* Ù…Ø¹Ø§ÙŠÙ†Ø© QR */
    .qr-preview-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px dashed #ccc;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      background-color: #f9f9f9;
    }

    .qr-preview-img {
      width: 100px;
      height: 100px;
      margin-top: 10px;
      object-fit: contain;
    }

    .en-input {
      font-family: 'Roboto', sans-serif;
      direction: ltr;
      text-align: left;
    }

    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© */
    .modal {
      display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5); /* Ø®Ù„ÙÙŠØ© Ø´Ø¨Ù‡ Ø´ÙØ§ÙØ© */
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: #fefefe;
      padding: 20px;
      border: 1px solid #888;
      border-radius: 8px;
      width: 90%;
      max-width: 800px; /* Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø© */
      text-align: center;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }

    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close-modal:hover { color: black; }

    .preview-container {
      border: 1px solid #ddd;
      padding: 10px;
      margin: 10px 0;
      transform: scale(0.7); /* ØªØµØºÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© */
      transform-origin: top center;
    }

    @media (max-width: 600px) {
      .form-grid { grid-template-columns: 1fr; }
      .container { padding: 20px; }
      .preview-container { transform: scale(0.4); }
    }

    /* ================= CARD PREVIEW STYLES ================= */
    .card-preview {
      width: 555pt;
      height: 802pt;
      background: #fff;
      position: relative;
      overflow: hidden;
      margin: 0 auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .card-bg-img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .card-content {
      position: relative;
      z-index: 1;
      padding: 0 45pt;
    }

    .card-header {
      position: absolute;
      top: 95pt;
      left: 0;
      right: 0;
      text-align: center;
      color: #8B2B3E;
      z-index: 10;
    }

    .card-header h1 {
      margin: 0;
      font-size: 18pt;
      font-weight: 700;
      line-height: 1.2;
    }

    .card-header p {
      margin: 4pt 0 0 0;
      font-size: 11pt;
      font-family: "Roboto";
      font-weight: 500;
      color: #707070;
    }

    .card-qr {
      position: absolute;
      top: 75pt;
      left: 60pt;
      width: 75pt;
      height: 75pt;
      z-index: 10;
      background: white;
      padding: 4px;
      border-radius: 4px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .card-section {
      margin-top: 170pt;
    }

    .card-section + .card-section {
      margin-top: 30pt;
    }

    .card-section-title {
      background: #fff;
      padding: 10pt 45pt;
      margin: 0 -45pt;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #8B2B3E;
      font-weight: 700;
      font-size: 14pt;
    }

    .card-section-body {
      background: #f3f4f6;
      padding: 25pt 45pt;
      margin: 0 -45pt;
    }

    .card-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14pt 30pt;
    }

    .card-row {
      position: relative;
      min-height: 20pt;
      font-size: 11pt;
      line-height: 1.7;
    }

    .card-label {
      position: absolute;
      inset-inline-start: 0;
      color: #707070;
      font-weight: 400;
      white-space: nowrap;
    }

    .card-value {
      position: absolute;
      inset-inline-start: 140px;
      font-weight: 500;
      color: #000;
      white-space: nowrap;
    }

    .card-value-ar {
      direction: rtl;
      text-align: right;
    }

    .card-value-en {
      direction: ltr;
      text-align: left;
    }

    .card-ltr {
      direction: ltr;
      font-family: "Roboto";
    }

    .card-footer {
      position: absolute;
      bottom: 45pt;
      left: 45pt;
      right: 45pt;
      display: flex;
      justify-content: space-between;
      font-size: 8pt;
      line-height: 1.6;
      color: #333;
      z-index: 2;
    }

    .card-footer div {
      width: 48%;
    }

    /* Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
    .card-bg-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #f8f8f8;
      z-index: 0;
    }
  </style>
  

</head>

<body>

  <div class="container">
    <h2 class="page-title">Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</h2>

    <form id="driverCardForm">
      
      <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ -->
      <div class="section-title">ğŸ§¾ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ (Driver Card Info)</div>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ (Driver Card Number)</label>
          <input type="text" name="driver_card_number" id="driver_card_number" placeholder="Ù…Ø«Ø§Ù„: 11.00537649" required oninput="generateQR()">
        </div>
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" name="driver_name_ar" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" required>
        </div>
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" name="driver_name_en" class="en-input" placeholder="Full Name in English" required>
        </div>
        <div class="form-group full-width">
          <label>Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ø³Ø§Ø¦Ù‚ (Driver ID)</label>
          <input type="number" name="driver_id" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© / Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©" required>
        </div>
        <div class="form-group">
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± (Issue Date)</label>
          <input type="date" name="issue_date" required>
        </div>
        <div class="form-group">
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Expiration Date)</label>
          <input type="date" name="expiry_date" required>
        </div>
        <div class="form-group">
          <label>ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø¹Ø±Ø¨ÙŠ)</label>
          <select name="card_category_ar" onchange="syncCategory('ar', this.value)">
            <option value="Ù…Ù‚ÙŠØ¯Ø©">Ù…Ù‚ÙŠØ¯Ø©</option>
            <option value="Ø®Ø§ØµØ©">Ø®Ø§ØµØ©</option>
            <option value="Ø¹Ø§Ù…Ø©">Ø¹Ø§Ù…Ø©</option>
            <option value="Ø£Ø¬Ø±Ø©">Ø£Ø¬Ø±Ø©</option>
          </select>
        </div>
        <div class="form-group">
          <label>ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <select name="card_category_en" class="en-input" id="cat_en_select" onchange="syncCategory('en', this.value)">
            <option value="Restricted">Restricted</option>
            <option value="Private">Private</option>
            <option value="Public">Public</option>
            <option value="Taxi">Taxi</option>
          </select>
        </div>
      </div>

      <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© QR -->
      <div class="qr-preview-container">
        <label>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø±Ù…Ø² QR (QR Code Preview)</label>
        <img id="qr_preview_img" class="qr-preview-img" src="" alt="QR Preview" style="display:none;">
        <span id="qr_placeholder" style="color: #999; font-size: 12px;">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span>
        <!-- Ø­Ù‚Ù„ Ù…Ø®ÙÙŠ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø³ÙŠØ±ÙØ± -->
        <input type="hidden" name="qr_image_url" id="qr_image_url">
      </div>

      <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© -->
      <div class="section-title">ğŸ¢ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙˆØ§Ù„ØªØ±Ø®ÙŠØµ (License & Company Info)</div>
      <div class="form-grid">
        <div class="form-group">
          <label>Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ (License Number)</label>
          <input type="text" name="license_number" placeholder="Ù…Ø«Ø§Ù„: 11/00052782" required>
        </div>
        <div class="form-group">
          <label>Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" name="license_city_ar" placeholder="Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ" required>
        </div>
        <div class="form-group">
          <label>Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" name="license_city_en" class="en-input" placeholder="License City" required>
        </div>
        <div class="form-group">
          <label>ØªØ§Ø±ÙŠØ® Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ±Ø®ÙŠØµ</label>
          <input type="date" name="license_issue_date" required>
        </div>
        <div class="form-group">
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ</label>
          <input type="date" name="license_expiry_date" required>
        </div>
        <div class="form-group full-width">
          <label>Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø´Ø£Ø© (MOI Number)</label>
          <input type="number" name="moi_number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ / Ø§Ù„Ù‡ÙˆÙŠØ©" required>
        </div>
        <div class="form-group full-width">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø· (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" name="activity_type_ar" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø«Ù‚ÙŠÙ„ Ù„Ù„Ø¨Ø¶Ø§Ø¦Ø¹" required>
        </div>
        <div class="form-group full-width">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø· (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" name="activity_type_en" class="en-input" placeholder="Activity Type (English)" required>
        </div>
        <div class="form-group full-width">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© (Ø¹Ø±Ø¨ÙŠ)</label>
          <input type="text" name="company_name_ar" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„" required>
        </div>
        <div class="form-group full-width">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
          <input type="text" name="company_name_en" class="en-input" placeholder="Company Name LTD." required>
        </div>
      </div>

      <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
      <div class="actions">
        <button type="button" class="btn btn-preview" onclick="openPreview()">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØµÙ…ÙŠÙ… (Preview)</button>
        <button type="button" class="btn btn-submit" onclick="handleFormSubmit()">Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ PDF (Print)</button>
      </div>

    </form>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Modal) -->
  <div id="previewModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closePreview()">&times;</span>
      <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h3>
      <div id="previewArea" class="preview-container">
        <!-- Ø³ÙŠØªÙ… ÙˆØ¶Ø¹ HTML Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù‡Ù†Ø§ -->
      </div>
      <button class="btn btn-submit" style="margin-top:20px;" onclick="confirmAndPrint()">ØªØ£ÙƒÙŠØ¯ ÙˆØªÙ†Ø²ÙŠÙ„ PDF</button>
    </div>
  </div>

  <script>
    // Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ QR Code ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ
    function generateQR() {
      const cardNumber = document.getElementById('driver_card_number').value;
      const qrImg = document.getElementById('qr_preview_img');
      const qrPlaceholder = document.getElementById('qr_placeholder');
      const qrUrlInput = document.getElementById('qr_image_url');

      if (cardNumber.length > 3) {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ø®Ø§Ø±Ø¬ÙŠ Ù„ØªÙˆÙ„ÙŠØ¯ QR Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        const apiURL = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${cardNumber}`;
        
        qrImg.src = apiURL;
        qrImg.style.display = 'block';
        qrPlaceholder.style.display = 'none';
        
        // Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ
        qrUrlInput.value = apiURL;
      } else {
        qrImg.style.display = 'none';
        qrPlaceholder.style.display = 'block';
        qrUrlInput.value = '';
      }
    }

    // Ø¯Ø§Ù„Ø© Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ
    function syncCategory(lang, value) {
      const arMap = { 'Ù…Ù‚ÙŠØ¯Ø©': 'Restricted', 'Ø®Ø§ØµØ©': 'Private', 'Ø¹Ø§Ù…Ø©': 'Public', 'Ø£Ø¬Ø±Ø©': 'Taxi' };
      const enMap = { 'Restricted': 'Ù…Ù‚ÙŠØ¯Ø©', 'Private': 'Ø®Ø§ØµØ©', 'Public': 'Ø¹Ø§Ù…Ø©', 'Taxi': 'Ø£Ø¬Ø±Ø©' };

      if (lang === 'ar') {
        document.getElementById('cat_en_select').value = arMap[value];
      } else {
        document.getElementById('cat_en_select').value = value;
      }
    }

    // Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    function openPreview() {
      const form = document.getElementById('driverCardForm');
      if(!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      
      // Ø¥Ù†Ø´Ø§Ø¡ HTML Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
      const cardHTML = generateCardHTML(data);
      document.getElementById('previewArea').innerHTML = cardHTML;
      document.getElementById('previewModal').style.display = 'flex';
    }

    function closePreview() {
      document.getElementById('previewModal').style.display = 'none';
    }

    // Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙˆØªÙ†Ø²ÙŠÙ„ PDF Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
    function confirmAndPrint() {
      closePreview();
      handleFormSubmit();
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ HTML Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    function generateCardHTML(data) {
      return `
      <div class="pdf-scope">
        <div class="card-preview" id="cardToPrint">
          <div class="card-bg-placeholder"></div>
            <img src="./1.png" class="bg-img" alt="Background" />
          
          <img class="card-qr" src="${data.qr_image_url}" alt="QR Code" />
          
          <div class="card-header">
            <h1>Ø¨Ø·Ø§Ù‚Ø© Ø³Ø§Ø¦Ù‚ - Driver Card</h1>
            <p>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${data.driver_card_number}</p>
          </div>
          
          <div class="card-content">
            <!-- SECTION 1 -->
            <div class="card-section">
              <div class="card-section-title">
                <span>Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</span>
                <span class="card-ltr">Driver Card Info</span>
              </div>
              <div class="card-section-body">
                <div class="card-grid">
                  <div>
                    <div class="card-row"><span class="card-label">Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚:</span><span class="card-value card-value-ar">${data.driver_card_number}</span></div>
                    <div class="card-row"><span class="card-label">Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:</span><span class="card-value card-value-ar">${data.driver_name_ar}</span></div>
                    <div class="card-row"><span class="card-label">Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ø³Ø§Ø¦Ù‚:</span><span class="card-value card-value-ar">${data.driver_id}</span></div>
                    <div class="card-row"><span class="card-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</span><span class="card-value card-value-ar">${data.issue_date}</span></div>
                    <div class="card-row"><span class="card-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</span><span class="card-value card-value-ar">${data.expiry_date}</span></div>
                    <div class="card-row"><span class="card-label">ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</span><span class="card-value card-value-ar">${data.card_category_ar}</span></div>
                  </div>
                  <div class="card-ltr">
                    <div class="card-row"><span class="card-label">Driver Card Number:</span><span class="card-value card-value-en">${data.driver_card_number}</span></div>
                    <div class="card-row"><span class="card-label">Driver Name:</span><span class="card-value card-value-en">${data.driver_name_en}</span></div>
                    <div class="card-row"><span class="card-label">Driver Id:</span><span class="card-value card-value-en">${data.driver_id}</span></div>
                    <div class="card-row"><span class="card-label">Issue Date:</span><span class="card-value card-value-en">${data.issue_date}</span></div>
                    <div class="card-row"><span class="card-label">Expiration Date:</span><span class="card-value card-value-en">${data.expiry_date}</span></div>
                    <div class="card-row"><span class="card-label">Card Category:</span><span class="card-value card-value-en">${data.card_category_en}</span></div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- SECTION 2 -->
            <div class="card-section">
              <div class="card-section-title">
                <span>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ùˆ Ø§Ù„ØªØ±Ø®ÙŠØµ</span>
                <span class="card-ltr">License and Company Info</span>
              </div>
              <div class="card-section-body">
                <div class="card-grid">
                  <div>
                    <div class="card-row"><span class="card-label">Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ:</span><span class="card-value card-value-ar">${data.license_number}</span></div>
                    <div class="card-row"><span class="card-label">Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ:</span><span class="card-value card-value-ar">${data.license_city_ar}</span></div>
                    <div class="card-row"><span class="card-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</span><span class="card-value card-value-ar">${data.license_issue_date}</span></div>
                    <div class="card-row"><span class="card-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</span><span class="card-value card-value-ar">${data.license_expiry_date}</span></div>
                    <div class="card-row"><span class="card-label">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·:</span><span class="card-value card-value-ar">${data.activity_type_ar}</span></div>
                    <div class="card-row"><span class="card-label">Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</span><span class="card-value card-value-ar">${data.moi_number}</span></div>
                    <div class="card-row"><span class="card-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</span><span class="card-value card-value-ar">${data.company_name_ar}</span></div>
                  </div>
                  <div class="card-ltr">
                    <div class="card-row"><span class="card-label">License Number:</span><span class="card-value card-value-en">${data.license_number}</span></div>
                    <div class="card-row"><span class="card-label">License City:</span><span class="card-value card-value-en">${data.license_city_en}</span></div>
                    <div class="card-row"><span class="card-label">Issue Date:</span><span class="card-value card-value-en">${data.license_issue_date}</span></div>
                    <div class="card-row"><span class="card-label">Expiry Date:</span><span class="card-value card-value-en">${data.license_expiry_date}</span></div>
                    <div class="card-row"><span class="card-label">Activity Type:</span><span class="card-value card-value-en">${data.activity_type_en}</span></div>
                    <div class="card-row"><span class="card-label">MOI Number:</span><span class="card-value card-value-en">${data.moi_number}</span></div>
                    <div class="card-row"><span class="card-label">Name:</span><span class="card-value card-value-en">${data.company_name_en}</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card-footer">
            <div>
              <p>
                * ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ø§Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© ÙˆØºÙŠØ± Ù…Ø®ÙˆÙ„ Ù„ØµØ§Ø­Ø¨Ù‡Ø§
                Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ù†Ø´Ø§Ø·
              </p>
              <p>* ÙŠØ¬Ø¨ Ø¥Ø¨Ø±Ø§Ø² Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ù…Ø®ÙˆÙ„ÙŠÙ† Ø¨ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙØªÙŠØ´ Ø¹Ù†Ø¯ Ø·Ù„Ø¨Ù‡Ø§.</p>
            </div>
            <div class="card-ltr">
              <p>
                * The card is used to close government procedures and its owner is
                not authorized to practice the activity
              </p>
              <p>* Kindly show this card to the authorized inspector if needed.</p>
            </div>
          </div>
        </div>
        </div>
      `;
    }

    async function handleFormSubmit() {
  const form = document.getElementById('driverCardForm');
  const submitBtn = document.querySelector('.btn-submit');
  const originalText = submitBtn.textContent;

  submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...';
  submitBtn.disabled = true;

  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());

  try {
    // Ø¥Ù†Ø´Ø§Ø¡ HTML Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    const cardHTML = generateCardHTML(data);

    // Ø¹Ù†ØµØ± Ù…Ø¤Ù‚Øª
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = cardHTML;
    tempDiv.style.position = 'fixed';
    tempDiv.style.left = '-10000px';
    tempDiv.style.top = '0';
    document.body.appendChild(tempDiv);

    const cardElement = tempDiv.querySelector('#cardToPrint');

    // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Canvas Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©
    const canvas = await html2canvas(cardElement, {
      scale: 2.5,              // Ø¬ÙˆØ¯Ø© Ù…Ù…ØªØ§Ø²Ø© Ø¨Ø¯ÙˆÙ† ØªØ¶Ø®ÙŠÙ… Ù…Ø¨Ø§Ù„Øº
      useCORS: true,
      backgroundColor: '#ffffff'
    });

    document.body.removeChild(tempDiv);

    // ØªØ­ÙˆÙŠÙ„ px â†’ mm
    const pxToMm = px => px * 0.264583;
    const pdfWidth = pxToMm(canvas.width);
    const pdfHeight = pxToMm(canvas.height);

    const { jsPDF } = window.jspdf;

    // Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¨Ù†ÙØ³ Ø­Ø¬Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø¨Ø¯ÙˆÙ† A4)
    const pdf = new jsPDF({
      orientation: pdfWidth > pdfHeight ? 'landscape' : 'portrait',
      unit: 'mm',
      format: [pdfWidth, pdfHeight]
    });

    const imgData = canvas.toDataURL('image/png', 1.0);

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù‡ÙˆØ§Ù…Ø´
    pdf.addImage(
      imgData,
      'PNG',
      0,
      0,
      pdfWidth,
      pdfHeight,
      undefined,
      'FAST'
    );

    pdf.save(`driver-card-${data.driver_card_number}.pdf`);
    alert('ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');

  } catch (err) {
    console.error(err);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù„Ù');
  }

  submitBtn.textContent = originalText;
  submitBtn.disabled = false;
}

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡
    window.onclick = function(event) {
      const modal = document.getElementById('previewModal');
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>

</body>
</html>